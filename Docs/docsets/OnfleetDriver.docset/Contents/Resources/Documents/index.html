<!DOCTYPE html>
<html lang="en">
  <head>
    <title>OnfleetDriver  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>


    <a title="OnfleetDriver  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Onfleet Driver SDK for iOS
        </a>
         (0% documented)
      </p>
    
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/onfleet/ios-driver-sdk">
            <img class="header-icon" src="img/gh.png" alt="GitHub"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">OnfleetDriver Reference</a>
      <img class="carat" src="img/carat.png" alt=""/>
      OnfleetDriver  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Driver%20Context.html">Driver Context</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/DriverContext.html">DriverContext</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Config.html">Config</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Session.html">Session</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/SessionManaging.html">SessionManaging</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Account.html">Account</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/LogoutReason.html">LogoutReason</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/InvitationResponse.html">InvitationResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Credentials.html">Credentials</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PhoneNumber.html">PhoneNumber</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Driver.html">Driver</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/DriverManaging.html">DriverManaging</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Driver.html">Driver</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Task.html">Task</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Task/Requirements.html">– Requirements</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Organization.html">Organization</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Organization/Billing.html">– Billing</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Organization/CompletionReason.html">– CompletionReason</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Vehicle.html">Vehicle</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Address.html">Address</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Recipient.html">Recipient</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Destination.html">Destination</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Barcode.html">Barcode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CompletedTasksProviding.html">CompletedTasksProviding</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTask.html">CompletedTask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTask/Requirements.html">– Requirements</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTask/CompletionDetails.html">– CompletionDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTask/RecipientContainer.html">– RecipientContainer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTask/ComputedContainer.html">– ComputedContainer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTask/Attachment.html">– Attachment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTask/Identity.html">– Identity</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TaskCompletionDetails.html">TaskCompletionDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TaskCompletionDetails/AgeVerification.html">– AgeVerification</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TaskCompletionDetails/Result.html">– Result</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Location.html">Location</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/LocationManaging.html">LocationManaging</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Attachments.html">Attachments</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/AttachmentsManaging.html">AttachmentsManaging</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/AttachmentsDelegate.html">AttachmentsDelegate</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ImageAttachment.html">ImageAttachment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PhotoAttachments.html">PhotoAttachments</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/SignatureAttachment.html">SignatureAttachment</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ImagePreparationResult.html">ImagePreparationResult</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Observables.html">Observables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ObservableModel.html">ObservableModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Model.html">Model</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ModelProperty.html">ModelProperty</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Guides.html">Other Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="basic-usage.html">Basic Usage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="installation.html">Installation</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Global%20Variables.html">Other Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Global%20Variables/SessionDidLogOutReasonKey.html">SessionDidLogOutReasonKey</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Enums.html">Other Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/AnalyticsError.html">AnalyticsError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CompleteTaskError.html">CompleteTaskError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CompletedTasksError.html">CompletedTasksError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DataState.html">DataState</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DutyStatusError.html">DutyStatusError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FetchingState.html">FetchingState</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FileLocation.html">FileLocation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/HTTPError.html">HTTPError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/HttpApi.html">HttpApi</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/HttpApi/ApiError.html">– ApiError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/LoginError.html">LoginError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/LoginStatus.html">LoginStatus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/LoginStatus/LoginOperationType.html">– LoginOperationType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/LogoutError.html">LogoutError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RecipientContactMode.html">RecipientContactMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/RemoveAccountRequest.html">RemoveAccountRequest</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ResetPasswordError.html">ResetPasswordError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SelfAssignError.html">SelfAssignError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/StartTaskError.html">StartTaskError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/UnitSystem.html">UnitSystem</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/UpdateProfileError.html">UpdateProfileError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/VehicleType.html">VehicleType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AccountsController.html">AccountsController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ActiveTaskStatistics.html">ActiveTaskStatistics</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Analytics.html">Analytics</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AnalyticsPeriod.html">AnalyticsPeriod</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AuthRefresher.html">AuthRefresher</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CLLocationCoordinate2D.html">CLLocationCoordinate2D</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/DriverManager.html">DriverManager</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FetchOptions.html">FetchOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/HttpAnyEndpoint.html">HttpAnyEndpoint</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/HttpHeader.html">HttpHeader</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Location.html">Location</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Location/TrackingMode.html">– TrackingMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Location/Tracker.html">– Tracker</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Location/RegionsMonitoringService.html">– RegionsMonitoringService</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/LocationData.html">LocationData</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/LocationService.html">LocationService</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/ModelDataFetcher.html">ModelDataFetcher</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Notification.html">Notification</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Notification/Name.html">– Name</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Optional.html">Optional</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Scheme.html">Scheme</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Structs.html">Other Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/AnalyticsStorgateFileName.html">AnalyticsStorgateFileName</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BarcodeRequest.html">BarcodeRequest</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompletedTaskStats.html">CompletedTaskStats</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DriverLicense.html">DriverLicense</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DriverProfileDetails.html">DriverProfileDetails</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DriverProfileDetails/Vehicle.html">– Vehicle</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DriverProfileDetails/Value.html">– Value</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Metadata.html">Metadata</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Metadata/ValueType.html">– ValueType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Metadata/Visibility.html">– Visibility</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <p><img src="https://user-images.githubusercontent.com/500145/104442724-bdef5980-5595-11eb-90f7-4ddf726a9979.png" alt="Onfleet Driver SDK for iOS"></p>

<p><a href="https://img.shields.io/badge/pod-1.9.3-orange.svg"><img src="https://img.shields.io/badge/pod-1.9.3-orange.svg?style=flat" alt="CocoaPods Compatible"></a>
<a href="https://developer.apple.com/swift/"><img src="https://img.shields.io/badge/Swift-5.3-orange.svg?style=flat" alt="Swift 5.3"></a>
<a href="https://developer.apple.com/swift/"><img src="https://img.shields.io/badge/platform-iOS-orange.svg?style=flat" alt="Platform iOS"></a>
<a href="https://github.com/twilio/twilio-verify-ios/blob/main/LICENSE"><img src="https://img.shields.io/badge/License-Apache%202-blue.svg?logo=law" alt="License"></a></p>
<h2 id='table-of-contents' class='heading'>Table of Contents</h2>

<ul>
<li><a href="#About">About</a></li>
<li><a href="#Requirements">Requirements</a></li>
<li><a href="#Documentation">Documentation</a></li>
<li><a href="#Installation">Installation</a></li>
<li><a href="#Integration">Integration</a>

<ul>
<li><a href="#Initialization">Initialization</a></li>
<li><a href="#PushNotifications">Push notifications</a></li>
<li><a href="#BackgroundExecution">Background execution</a></li>
<li><a href="#LocationPermissions">Location permissions</a></li>
</ul></li>
<li><a href="#Provision">Device Verification</a></li>
<li><a href="#SampleApp">Sample app</a></li>
</ul>

<p><a name='About'></a></p>
<h2 id='about' class='heading'>About</h2>

<p>Onfleet Driver SDK allows you to use Onfleet services directly in your iOS app. </p>

<p><a name='Requirements'></a></p>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 13+</li>
<li>Swift 5</li>
<li>Xcode 12.5+</li>
<li>Onfleet application key</li>
</ul>

<p><a name='Documentation'></a></p>
<h2 id='documentation' class='heading'>Documentation</h2>

<p>This repository contains auto-generated documentation. See <code>onfleet-driver-sdk/Docs/index.html</code>.</p>

<p><a name='Installation'></a></p>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='cocoapods' class='heading'>CocoaPods</h3>

<p><a href="https://cocoapods.org">CocoaPods</a> is a dependency manager for Cocoa projects. For usage and installation instructions, visit their website. </p>

<p>To integrate Onfleet Driver SDK into your Xcode project using CocoaPods, specify it in your <code>Podfile</code>:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'OnfleetDriver'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'https://github.com/onfleet/ios-driver-sdk.git'</span>
</code></pre>
<h3 id='manually' class='heading'>Manually</h3>

<p>Simply drag and drop <code>OnfleetDriver.xcframework</code> into your project and make sure it&rsquo;s linked and embeded with signing into your application&rsquo;s target.</p>
<h3 id='spm-amp-carthage' class='heading'>SPM &amp; Carthage</h3>

<p>Unfortunatelly we don&rsquo;t currently support SPM or Carthage, but we will do so in the near future.</p>

<p><a name='Integration'></a></p>
<h2 id='integration' class='heading'>Integration</h2>

<p><a name='Initialization'></a></p>
<h3 id='1-initialization' class='heading'>1. Initialization</h3>

<p>Import SDK into the source code where needed</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">OnfleetDriver</span>
</code></pre>

<p>Onfleet SDK should be initialized at the earliest convenience, ideally in <code>application(_:didFinishLaunchingWithOptions:)</code> function. </p>

<p>For example in your app delegate file:</p>
<pre class="highlight swift"><code>    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">LaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

        <span class="c1">//initiate SDK</span>
        <span class="k">let</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">Config</span><span class="p">(</span><span class="nv">appKey</span><span class="p">:</span> <span class="s">"&lt;#app key here#&gt;"</span><span class="p">,</span> <span class="nv">appVersion</span><span class="p">:</span> <span class="s">"&lt;#App version here#&gt;"</span><span class="p">,</span> <span class="nv">appName</span><span class="p">:</span> <span class="s">"&lt;#App name here#&gt;"</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="nf">initSDK</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> <span class="nv">environment</span><span class="p">:</span> <span class="o">.</span><span class="nf">production</span><span class="p">(</span><span class="nv">useApnSandbox</span><span class="p">:</span> <span class="kc">true</span><span class="p">),</span> <span class="nv">app</span><span class="p">:</span> <span class="n">application</span><span class="p">,</span> <span class="nv">loggers</span><span class="p">:</span> <span class="p">[</span><span class="kt">OSLogDestination</span><span class="p">(</span><span class="nv">logSeverity</span><span class="p">:</span> <span class="o">.</span><span class="n">warning</span><span class="p">)])</span>

        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

</code></pre>

<p><a name='PushNotifications'></a></p>
<h3 id='2-push-notifications' class='heading'>2. Push notifications</h3>

<p>When SDK is initialized it automatically registers for remote notifications. Host app is however responsible for managing push notifications and delivering them to the SDK through methods defined in <code><a href="Classes/DriverContext.html">DriverContext</a></code> class. If push notifications will not be forwarded several features will stop working (including <a href="#Provision">device verification</a>) or will not work as expected.</p>

<p>For example in your app delegate file update code below initialization like this:</p>
<pre class="highlight swift"><code>    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">LaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

        <span class="c1">//initiate SDK</span>

        <span class="c1">//enable push notification</span>
        <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">center</span><span class="o">.</span><span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">])</span> <span class="p">{</span> <span class="n">granted</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"user notification alerts and sound: </span><span class="se">\(</span><span class="n">granted</span> <span class="p">?</span> <span class="s">"granted"</span> <span class="p">:</span> <span class="s">"denied"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didRegisterForRemoteNotificationsWithDeviceToken</span> <span class="nv">deviceToken</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//forward device token into SDK</span>
        <span class="n">driver</span><span class="o">.</span><span class="nf">setRemoteNotificationsDeviceToken</span><span class="p">(</span><span class="n">deviceToken</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didReceiveRemoteNotification</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="p">[</span><span class="kt">AnyHashable</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">//forward push notification userInfo into SDK if possible </span>
        <span class="k">if</span> <span class="n">driver</span><span class="o">.</span><span class="nf">canHandleRemoteNotification</span><span class="p">(</span><span class="nv">userInfo</span><span class="p">:</span> <span class="n">userInfo</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">driver</span><span class="o">.</span><span class="nf">handleRemoteNotification</span><span class="p">(</span><span class="nv">userInfo</span><span class="p">:</span> <span class="n">userInfo</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// process non-onfleet notifications</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// please note that also user notifications (alerts/banners) must be forwarded into SDK from UNUserNotificationCenterDelegate's method</span>
    <span class="kd">func</span> <span class="nf">userNotificationCenter</span><span class="p">(</span><span class="n">_</span> <span class="nv">center</span><span class="p">:</span> <span class="kt">UNUserNotificationCenter</span><span class="p">,</span> <span class="n">willPresent</span> <span class="nv">notification</span><span class="p">:</span> <span class="kt">UNNotification</span><span class="p">,</span> <span class="n">withCompletionHandler</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">UNNotificationPresentationOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">driver</span><span class="o">.</span><span class="nf">canHandleRemoteNotification</span><span class="p">(</span><span class="nv">userInfo</span><span class="p">:</span> <span class="n">notification</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">userInfo</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">driver</span><span class="o">.</span><span class="nf">handleRemoteNotification</span><span class="p">(</span><span class="n">notification</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// provide logic for non-onfleet banners</span>
            <span class="nf">completionHandler</span><span class="p">([</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">])</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>

<p>Please refer to Sample app for full integration example.</p>

<p><a name='BackgroundExecution'></a></p>
<h3 id='3-background-execution' class='heading'>3. Background execution</h3>

<p>Apps powered by Onfleet SDK require collecting user location while the driver is on duty. Often iOS system kills backgrounded apps due to memory preassure so in case of background termination app must be woken up on the backgorund asap and continue collecting locations. This is achieved by combination of multiple techniques especially <code>background location updates</code>, <code>silent push notifications</code> and correct <code>location permissions</code> granted by user. </p>

<p>To achieve correct results pls enable in your Xcode project under your app schemes following background mode capabilities:</p>

<ol>
<li>Location Updates</li>
<li>Remote Notifications</li>
<li>Background Fetch</li>
</ol>

<p><a name='LocationPermissions'></a></p>
<h3 id='4-location-permissions' class='heading'>4. Location permissions</h3>

<p>Following location permissions are required:</p>

<ol>
<li>Location -&gt; Allow location access -&gt; <strong>Always</strong></li>
<li>Precise Location -&gt; <strong>On</strong>
This will be referred as <em>full location permissions</em> going forward.</li>
</ol>

<p>Following privacy description must be set in <code>Info.plist</code></p>
<pre class="highlight plaintext"><code>&lt;key&gt;NSLocationAlwaysAndWhenInUseUsageDescription&lt;/key&gt;
&lt;string&gt;Onfleet only tracks your location when on-duty in order to provide analytics and dispatch work to you.&lt;/string&gt;
</code></pre>

<p>Unfortunatelly, current iOS permissions policy does not open apps in the background if location access is set to <strong>While in Use</strong> or <strong>Once</strong>. This requires apps to ask <em>full location permissions</em>. Asking this is sensitive and it is up to SDK integrator to design a flow that is suitable for their users. </p>

<p>Please follow these rules when implementing your own flow:</p>

<ol>
<li>enforce &ldquo;Always&rdquo; no sooner than when going on duty. Don&rsquo;t allow going on duty unless <em>full location permissions</em> are granted.</li>
<li>if driver revokes <em>full location permissions</em> while on duty make sure she goes either off duty or grants <em>full location permissions</em>.<br></li>
</ol>

<p>Good practice is to verify permissions before driver attempts to go on duty and present a screen with reasons why these permissions are required. Then app should request access <em>when in use</em> or <em>always</em>, then guide user to open Settings app and manually select location access <strong>Always</strong>. If precise location is off, similar flow should ask for precise location to be <strong>on</strong>.</p>

<p>Here are reasons why Onfleet requires <em>full location permissions</em>:</p>

<ol>
<li>dispatchers can see drivers in real time on web Dashboard</li>
<li>delivery recipients can see drivers in real time</li>
<li>task delivery ETA is continually recalculated to provide better precisions to recipients</li>
<li>locations are used for driver analytics, especially distance driven. Some drivers may be paid by according to this data so precision must be as accurate as possible.</li>
<li>SDK never tracks driver&rsquo;s location when off duty</li>
<li>system can open suspended application on background so it can continue sending locations to our server</li>
</ol>

<p>Protocol in <code>LocationManaging.swift</code> provides a conveniece wrapper for observing location permissions. Our Sample app contains an example flow.  </p>

<p>Please refer to Sample app for full integration example.</p>

<p><a name='Provision'></a></p>
<h2 id='device-verification' class='heading'>Device Verification</h2>

<p>Due to security reasons each device must be verified. Verification is performed only once and the process is done automatically first time the driver logs in. Please note, that push notifications are used to deliver tokens securely therefore <a href="#PushNotifications">push notifications must be set up properly</a>.</p>

<p>Because of push notifications don&rsquo;t work in iOS simulators we must bypass apn servers and deliver tokens manually. This can be done exclusively on iOS simulators using <code>provision.sh</code> script. Please consult the documentation of the script for more details simply by running the script in Terminal.</p>

<p>Please note that bypassing apn servers with the provision script will work only for <code>test accounts</code>. These are Onfleet organizations with special flag. The following criteria must be met before an org can be flagged as test account:</p>

<ul>
<li>Test drivers must exist in a single organization for which the sdk/application id
above is provisioned.</li>
<li>If an account is test account and the driver is added
to multiple organizations, the account no longer qualifies as a test account.</li>
<li>Similarly, if an account is a test account and the driver is removed from that
organization, the account no longer qualifies as a test account.</li>
</ul>

<p>If you meet the criteria above and you wish to flag your driver account as test
account, please contact Onfleet support at <a href="mailto:support@onfleet.com">support@onfleet.com</a>.</p>

<p><a name='SampleApp'></a></p>
<h2 id='sample-app' class='heading'>Sample app</h2>

<p>This repository contains <code>Sample App</code> project that integrates Driver SDK. It provides an overview to core features and guides on how to use them in code. Following features are currently supported:</p>

<ul>
<li>Log in, log out, reset password</li>
<li>Accepting / rejecting invitations</li>
<li>Setting duty status</li>
<li>Fetching data</li>
<li>Tasks list</li>
<li>Task detail (claiming, starting, completing tasks)</li>
</ul>
<h3 id='set-up' class='heading'>Set up</h3>

<ol>
<li>clone <code>onfleet/ios-driver-sdk</code> repository using  <code>git clone git@github.com:onfleet/ios-driver-sdk.git</code></li>
<li>open root directory and install pods using <code>pod install</code></li>
<li>open <code>SampleApp.xcworkspace</code> in Xcode</li>
<li>in <code>AppDelegate.swift</code> file add your Onfleet <strong>application_id</strong></li>
<li>in target&rsquo;s Signing &amp; Capabilities update bundle identifier and team, please make sure that push notifications work</li>
<li>build and run using <code>SampleApp</code> scheme</li>
<li>when logging in for the first time please perform the <a href="#Provision">Device Verification</a>.</li>
</ol>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>© 2022 Onfleet, Inc.</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
    </section>
  </body>
</html>
